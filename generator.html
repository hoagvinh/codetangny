<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>T·∫°o Web T·∫∑ng Ng∆∞·ªùi Y√™u üíñ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Quicksand",sans-serif;
      background:#ffd1dc;
      padding:20px 0;
    }
    .container{
      width:90%;max-width:1100px;margin:0 auto;
      background:#ffeef2;border-radius:16px;
      box-shadow:0 8px 25px rgba(255,120,155,.35);
      padding:20px;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:20px;
    }
    h2{
      grid-column:1/3;
      text-align:center;
      color:#ff4b87;
      font-size:26px;
      margin-bottom:12px;
    }
    .panel{
      background:#fff;
      border-radius:12px;
      padding:14px;
      margin-bottom:12px;
    }
    .panel-title{
      font-weight:700;
      color:#ff4b87;
      margin-bottom:8px;
      font-size:15px;
    }
    .row{
      margin-bottom:10px;
    }
    .row label{
      display:block;
      font-size:13px;
      margin-bottom:4px;
      color:#444;
    }
    .row input[type="text"],
    .row input[type="date"]{
      width:100%;
      padding:8px 10px;
      border-radius:8px;
      border:1px solid #ffbfd2;
      font-size:13px;
    }
    .img-input{
      border:1px dashed #ff9cbc!important;
      padding:8px;
      background:#fff0f5;
      width:100%;
      font-size:12px;
    }
    .hint{
      font-size:11px;
      color:#777;
      margin-top:3px;
    }
    .btn{
      background:#003366;
      color:#fff;
      border:none;
      padding:9px 16px;
      border-radius:8px;
      cursor:pointer;
      font-size:14px;
      margin-right:8px;
    }
    .btn-pink{
      background:#ff4b8b;
    }
    .btn:disabled{
      opacity:0.6;
      cursor:not-allowed;
    }
    #result{
      width:100%;
      padding:9px 10px;
      border-radius:8px;
      border:1px solid #bbb;
      font-size:13px;
    }
    .copy-btn{
      margin-top:6px;
      background:#003366;
      color:#fff;
      padding:6px 10px;
      border-radius:6px;
      border:none;
      cursor:pointer;
      font-size:13px;
    }
    .preview-wrapper{
      background:#ffe5ec;
      border-radius:12px;
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .preview-wrapper h3{
      text-align:center;
      font-size:15px;
      color:#ff4b87;
    }
    iframe{
      width:100%;
      height:560px;
      border:none;
      border-radius:12px;
      background:#fff;
    }
    .loading-overlay{
      position:fixed;inset:0;
      background:rgba(0,0,0,0.35);
      display:flex;align-items:center;justify-content:center;
      z-index:999;display:none;
    }
    .loader{
      background:#fff;padding:16px 22px;border-radius:12px;
      box-shadow:0 6px 18px rgba(0,0,0,.25);
      display:flex;align-items:center;gap:10px;
      font-size:14px;
    }
    .spin{
      width:20px;height:20px;border-radius:50%;
      border:3px solid #ffd1e3;border-top-color:#ff4b8b;
      animation:spin .8s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    @media(max-width:900px){
      .container{grid-template-columns:1fr}
      h2{grid-column:1/2}
    }
  </style>
</head>

<body>

<div class="loading-overlay" id="loading">
  <div class="loader">
    <div class="spin"></div>
    <span id="loadingText">ƒêang x·ª≠ l√Ω...</span>
  </div>
</div>

<div class="container">
  <h2>T·∫°o Web T·∫∑ng Ng∆∞·ªùi Y√™u üíñ</h2>

  <!-- LEFT FORM -->
  <div>
    <!-- HERO -->
    <div class="panel">
      <div class="panel-title">Ph·∫ßn m·ªü ƒë·∫ßu</div>

      <div class="row">
        <label>D√≤ng ch√†o (t1)</label>
        <input type="text" data-key="t1" value="G·ª≠i em,">
      </div>

      <div class="row">
        <label>T√™n ng∆∞·ªùi y√™u (name)</label>
        <input type="text" data-key="name" value="Ph∆∞∆°ng">
      </div>

      <div class="row">
        <label>M√¥ t·∫£ ng·∫Øn (hero_desc)</label>
        <input type="text" data-key="hero_desc"
               value="Anh l√†m trang web nh·ªè n√†y d√†nh ri√™ng cho em.">
      </div>

      <div class="row">
        <label>·∫¢nh ch√≠nh (mainImg)</label>
        <input type="file" class="img-input" id="mainImg" accept="image/*">
        <div class="hint">* ·∫¢nh s·∫Ω ch·ªâ hi·ªán khi m·ªü link cu·ªëi, ph·∫ßn xem tr∆∞·ªõc d√πng ·∫£nh m·∫´u.</div>
      </div>
    </div>

    <!-- LETTER -->
    <div class="panel">
      <div class="panel-title">L√° th∆∞</div>
      <div class="row"><label>lt1</label><input type="text" data-key="lt1" value="G·ª≠i em,"></div>
      <div class="row"><label>lt2</label><input type="text" data-key="lt2" value="C·∫£m ∆°n em v√¨ ƒë√£ ƒë·∫øn b√™n anh."></div>
      <div class="row"><label>lt3</label><input type="text" data-key="lt3" value="Anh vi·∫øt t·∫•t c·∫£ v√†o ƒë√¢y cho em ƒë·ªçc."></div>
      <div class="row"><label>lt4</label><input type="text" data-key="lt4" value="Anh lu√¥n ·ªü ƒë√¢y v√¨ em."></div>
      <div class="row"><label>lt5</label><input type="text" data-key="lt5" value="Ch·ªâ c·∫ßn em mu·ªën, anh lu√¥n n·∫Øm tay em."></div>
      <div class="row"><label>K√Ω t√™n (sign)</label><input type="text" data-key="sign" value="‚Äì Anh c·ªßa em üíó"></div>
    </div>

    <!-- REASONS -->
    <div class="panel">
      <div class="panel-title">L√Ω do anh y√™u em (6 c√°i)</div>

      <div class="row"><label>L√Ω do 1 - Ti√™u ƒë·ªÅ (rt1)</label><input type="text" data-key="rt1" value="N·ª• c∆∞·ªùi c·ªßa em"></div>
      <div class="row"><label>L√Ω do 1 - N·ªôi dung (r1)</label><input type="text" data-key="r1" value="M·ªói l·∫ßn em c∆∞·ªùi, c·∫£ ng√†y c·ªßa anh nh∆∞ s√°ng l√™n."></div>

      <div class="row"><label>L√Ω do 2 - Ti√™u ƒë·ªÅ (rt2)</label><input type="text" data-key="rt2" value="S·ª± ch√¢n th√†nh"></div>
      <div class="row"><label>L√Ω do 2 - N·ªôi dung (r2)</label><input type="text" data-key="r2" value="Em lu√¥n ch√¢n th√†nh v·ªõi c·∫£m x√∫c c·ªßa m√¨nh."></div>

      <div class="row"><label>L√Ω do 3 - Ti√™u ƒë·ªÅ (rt3)</label><input type="text" data-key="rt3" value="Nh·ªØng bu·ªïi n√≥i chuy·ªán"></div>
      <div class="row"><label>L√Ω do 3 - N·ªôi dung (r3)</label><input type="text" data-key="r3" value="T·ª´ chuy·ªán linh tinh ƒë·∫øn nh·ªØng ∆∞·ªõc m∆° xa xƒÉm."></div>

      <div class="row"><label>L√Ω do 4 - Ti√™u ƒë·ªÅ (rt4)</label><input type="text" data-key="rt4" value="C√°ch em quan t√¢m"></div>
      <div class="row"><label>L√Ω do 4 - N·ªôi dung (r4)</label><input type="text" data-key="r4" value="Nh·ªØng c√¢u h·ªèi nh·ªè l√†m anh th·∫•y ƒë∆∞·ª£c y√™u."></div>

      <div class="row"><label>L√Ω do 5 - Ti√™u ƒë·ªÅ (rt5)</label><input type="text" data-key="rt5" value="C·∫£m gi√°c nh∆∞ 'nh√†'"></div>
      <div class="row"><label>L√Ω do 5 - N·ªôi dung (r5)</label><input type="text" data-key="r5" value="·ªû c·∫°nh em m·ªçi th·ª© ƒë·ªÅu nh·∫π nh√†ng h∆°n."></div>

      <div class="row"><label>L√Ω do 6 - Ti√™u ƒë·ªÅ (rt6)</label><input type="text" data-key="rt6" value="V√¨ ƒë√≥ l√† em"></div>
      <div class="row"><label>L√Ω do 6 - N·ªôi dung (r6)</label><input type="text" data-key="r6" value="ƒê∆°n gi·∫£n: v√¨ em l√† em."></div>
    </div>

    <!-- TIMELINE -->
    <div class="panel">
      <div class="panel-title">C√°c c·ªôt m·ªëc</div>

      <div class="row"><label>Tl1 - Ti√™u ƒë·ªÅ</label><input type="text" data-key="tlTitle1" value="Kho·∫£nh kh·∫Øc 1"></div>
      <div class="row"><label>Tl1 - N·ªôi dung</label><input type="text" data-key="tl1" value="Ng√†y ƒë·∫ßu t·ª•i m√¨nh n√≥i chuy·ªán nhi·ªÅu h∆°n."></div>

      <div class="row"><label>Tl2 - Ti√™u ƒë·ªÅ</label><input type="text" data-key="tlTitle2" value="Kho·∫£nh kh·∫Øc 2"></div>
      <div class="row"><label>Tl2 - N·ªôi dung</label><input type="text" data-key="tl2" value="L·∫ßn ƒë·∫ßu g·∫∑p em ngo√†i ƒë·ªùi."></div>

      <div class="row"><label>Tl3 - Ti√™u ƒë·ªÅ</label><input type="text" data-key="tlTitle3" value="Kho·∫£nh kh·∫Øc 3"></div>
      <div class="row"><label>Tl3 - N·ªôi dung</label><input type="text" data-key="tl3" value="Ng√†y m√¨nh ch√≠nh th·ª©c b√™n nhau."></div>
    </div>

    <!-- GALLERY -->
    <div class="panel">
      <div class="panel-title">Kho·∫£nh kh·∫Øc (6 ·∫£nh)</div>
      <div class="row"><label>·∫¢nh 1 (g1)</label><input type="file" class="img-input" id="g1" accept="image/*"></div>
      <div class="row"><label>·∫¢nh 2 (g2)</label><input type="file" class="img-input" id="g2" accept="image/*"></div>
      <div class="row"><label>·∫¢nh 3 (g3)</label><input type="file" class="img-input" id="g3" accept="image/*"></div>
      <div class="row"><label>·∫¢nh 4 (g4)</label><input type="file" class="img-input" id="g4" accept="image/*"></div>
      <div class="row"><label>·∫¢nh 5 (g5)</label><input type="file" class="img-input" id="g5" accept="image/*"></div>
      <div class="row"><label>·∫¢nh 6 (g6)</label><input type="file" class="img-input" id="g6" accept="image/*"></div>
    </div>

    <!-- MUSIC -->
    <div class="panel">
      <div class="panel-title">Nh·∫°c n·ªÅn</div>
      <div class="row">
        <label>Ch·ªçn file nh·∫°c (mp3/m4a/wav)</label>
        <input type="file" class="img-input" id="musicFile" accept="audio/*">
        <div class="hint">* N·∫øu kh√¥ng ch·ªçn, trang s·∫Ω d√πng nh·∫°c m·∫∑c ƒë·ªãnh.</div>
      </div>
    </div>

    <!-- COUNTDOWN -->
    <div class="panel">
      <div class="panel-title">Ng√†y ƒë·∫∑c bi·ªát</div>
      <div class="row">
        <label>Ng√†y k·ªâ ni·ªám (countdown)</label>
        <input type="date" id="cdDate">
      </div>

      <button class="btn btn-pink" id="btnGenerate" onclick="generateLink()">T·∫°o link</button>
      <div style="margin-top:8px">
        <input id="result" readonly>
        <button class="copy-btn" onclick="copyLink()">Copy</button>
      </div>
    </div>
  </div>

  <!-- RIGHT PREVIEW -->
  <div class="preview-wrapper">
    <h3>Xem tr∆∞·ªõc (ch·ªâ text, ·∫£nh l√† m·∫´u)</h3>
    <iframe id="preview" src="romantic.html"></iframe>
  </div>
</div>
<script>
  const API_KEY = "eae1cb64977674d24a369088982e004a"; // imgbb API key c·ªßa m√†y

  /* =============================
      L·∫§Y TEXT PARAMS
  ============================= */
  function collectTextParams(){
    const params = new URLSearchParams();

    document.querySelectorAll("[data-key]").forEach(el=>{
      const key = el.dataset.key;
      const val = el.value.trim();
      if(val) params.set(key, val);
    });

    const cd = document.getElementById("cdDate").value;
    if(cd){
      params.set("cd", cd + "T00:00:00");
    }

    return params;
  }

  /* =============================
      UPDATE PREVIEW
  ============================= */
  function updatePreview(){
    const params = collectTextParams();
    const url = "romantic.html" + (params.toString() ? "?" + params.toString() : "");
    document.getElementById("preview").src = url;
  }

  document.querySelectorAll("[data-key]").forEach(el=>{
    el.addEventListener("input", updatePreview);
  });
  document.getElementById("cdDate").addEventListener("change", updatePreview);


  /* =============================
      UPLOAD ·∫¢NH ‚Üí imgbb
  ============================= */
  async function uploadImageToImgbb(file) {

    const allowed = ["image/png", "image/jpg", "image/jpeg", "image/webp"];
    if (!allowed.includes(file.type)) {
      throw new Error("·∫¢nh kh√¥ng h·ª£p l·ªá: " + file.type);
    }

    const form = new FormData();
    form.append("image", file);

    const res = await fetch("https://api.imgbb.com/1/upload?key=" + API_KEY, {
      method: "POST",
      body: form
    });

    if (!res.ok) {
      throw new Error("Upload ·∫£nh th·∫•t b·∫°i (HTTP " + res.status + ")");
    }

    const data = await res.json();

    if (!data.success) {
      throw new Error("imgbb t·ª´ ch·ªëi ·∫£nh");
    }

    return data.data.url;
  }


  /* =============================
      UPLOAD NH·∫†C ‚Üí transfer.sh
  ============================= */
  async function uploadMusic(file) {
    const allowed = ["audio/mpeg", "audio/mp3", "audio/m4a", "audio/wav"];
    if (!allowed.includes(file.type)) {
      throw new Error("Nh·∫°c kh√¥ng h·ªó tr·ª£: " + file.type);
    }

    const res = await fetch("https://transfer.sh/" + encodeURIComponent(file.name), {
      method: "PUT",
      body: file
    });

    if (!res.ok) {
      throw new Error("Upload nh·∫°c th·∫•t b·∫°i (HTTP " + res.status + ")");
    }

    return (await res.text()).trim();
  }


  /* =============================
      GENERATE LINK
  ============================= */
  async function generateLink(){
    const btn = document.getElementById("btnGenerate");
    const loading = document.getElementById("loading");
    const loadingText = document.getElementById("loadingText");

    btn.disabled = true;
    loading.style.display = "flex";
    loadingText.textContent = "ƒêang upload file (n·∫øu c√≥)...";

    try{
      const params = collectTextParams();
      const imgIds = ["mainImg","g1","g2","g3","g4","g5","g6","musicFile"];

      for(const id of imgIds){
        const inp = document.getElementById(id);
        if(inp && inp.files && inp.files[0]){

          // Upload NH·∫†C
          if(id === "musicFile") {
            loadingText.textContent = "ƒêang upload nh·∫°c...";
            const link = await uploadMusic(inp.files[0]);
            params.set("musicFile", link);
          }

          // Upload ·∫¢NH
          else {
            loadingText.textContent = "ƒêang upload ·∫£nh: " + id + "...";
            const url = await uploadImageToImgbb(inp.files[0]);
            params.set(id, url);
          }
        }
      }

      const base = window.location.origin + window.location.pathname.replace("generator.html","romantic.html");
      const fullLink = base + "?" + params.toString();
      document.getElementById("result").value = fullLink;

      loadingText.textContent = "Ho√†n t·∫•t!";
    }
    catch(err){
      console.error(err);
      alert("L·ªói khi upload/t·∫°o link: " + err.message);
    }
    finally{
      setTimeout(()=>{ loading.style.display="none"; }, 500);
      btn.disabled = false;
    }
  }


  /* =============================
      COPY LINK
  ============================= */
  function copyLink(){
    const inp = document.getElementById("result");
    if(!inp.value){
      alert("Ch∆∞a c√≥ link ƒë·ªÉ copy");
      return;
    }
    inp.select();
    document.execCommand("copy");
    alert("ƒê√£ copy link!");
  }

  updatePreview();
</script>
